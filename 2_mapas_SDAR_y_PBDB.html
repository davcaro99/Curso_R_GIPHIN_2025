<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Caro, GIPHIN">
<meta name="dcterms.date" content="2025-06-14">

<title>Módulo 2: Datos de volcanes, mapas y modelos estadísticos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2_mapas_SDAR_y_PBDB_files/libs/clipboard/clipboard.min.js"></script>
<script src="2_mapas_SDAR_y_PBDB_files/libs/quarto-html/quarto.js"></script>
<script src="2_mapas_SDAR_y_PBDB_files/libs/quarto-html/popper.min.js"></script>
<script src="2_mapas_SDAR_y_PBDB_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2_mapas_SDAR_y_PBDB_files/libs/quarto-html/anchor.min.js"></script>
<link href="2_mapas_SDAR_y_PBDB_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2_mapas_SDAR_y_PBDB_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2_mapas_SDAR_y_PBDB_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2_mapas_SDAR_y_PBDB_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2_mapas_SDAR_y_PBDB_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Módulo 2: Datos de volcanes, mapas y modelos estadísticos</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Caro, GIPHIN </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 14, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="conjunto-de-datos-erupciones-volcánicas-en-el-holoceno" class="level1">
<h1>Conjunto de datos: Erupciones volcánicas en el Holoceno</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a cargar algunos de los paquetes a usar</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("maps","mapview","sf"))</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploración-inicial-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="exploración-inicial-de-los-datos">Exploración inicial de los datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar el archivo CSV que contiene los datos de volcanes y convertir columnas de caracteres a factores</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>volcanes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"datos/volcanes.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># La función mutate cambia, añade o quita columnas y sus valores  </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar las primeras 6 filas del data frame para tener una vista preliminar</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(volcanes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Number                      Name Country                         Region
1 210010 West Eifel Volcanic Field Germany Mediterranean and Western Asia
2 210020           Chaine des Puys  France Mediterranean and Western Asia
3 210030       Olot Volcanic Field   Spain Mediterranean and Western Asia
4 210040  Calatrava Volcanic Field   Spain Mediterranean and Western Asia
5 211001                Larderello   Italy Mediterranean and Western Asia
6 211003                   Vulsini   Italy Mediterranean and Western Asia
                 Type Activity.Evidence Last.Known.Eruption Latitude Longitude
1             Maar(s)    Eruption Dated            8300 BCE   50.170      6.85
2        Lava dome(s)    Eruption Dated            4040 BCE   45.775      2.97
3 Pyroclastic cone(s) Evidence Credible             Unknown   42.170      2.53
4 Pyroclastic cone(s)    Eruption Dated            3600 BCE   38.870     -4.02
5 Explosion crater(s) Eruption Observed             1282 CE   43.250     10.87
6             Caldera Eruption Observed             104 BCE   42.600     11.93
  Elevation..Meters.               Dominant.Rock.Type
1                600                          Foidite
2               1464            Basalt / Picro-Basalt
3                893 Trachybasalt / Tephrite Basanite
4               1117            Basalt / Picro-Basalt
5                500                          No Data
6                800          Trachyte / Trachydacite
                              Tectonic.Setting
1       Rift Zone / Continental Crust (&gt;25 km)
2       Rift Zone / Continental Crust (&gt;25 km)
3      Intraplate / Continental Crust (&gt;25 km)
4      Intraplate / Continental Crust (&gt;25 km)
5 Subduction Zone / Continental Crust (&gt;25 km)
6 Subduction Zone / Continental Crust (&gt;25 km)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#glimpse(volcanes)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la estructura del data frame: tipos de columnas, clases de datos y ejemplos de valores</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(volcanes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1508 obs. of  12 variables:
 $ Number             : int  210010 210020 210030 210040 211001 211003 211004 211010 211020 211030 ...
 $ Name               : Factor w/ 1478 levels "Abu","Acamarachi",..: 1429 236 949 209 711 1418 274 215 1405 553 ...
 $ Country            : Factor w/ 100 levels "Algeria","Algeria-Niger",..: 43 41 85 85 53 53 53 53 53 53 ...
 $ Region             : Factor w/ 19 levels "Africa and Red Sea",..: 12 12 12 12 12 12 12 12 12 12 ...
 $ Type               : Factor w/ 33 levels "Caldera","Caldera(s)",..: 16 14 18 18 8 1 1 1 22 3 ...
 $ Activity.Evidence  : Factor w/ 7 levels "","Eruption Dated",..: 2 2 4 2 3 3 5 3 3 3 ...
 $ Last.Known.Eruption: Factor w/ 399 levels "0 CE","1000 CE",..: 378 312 399 303 34 4 399 53 194 37 ...
 $ Latitude           : num  50.2 45.8 42.2 38.9 43.2 ...
 $ Longitude          : num  6.85 2.97 2.53 -4.02 10.87 ...
 $ Elevation..Meters. : int  600 1464 893 1117 500 800 949 458 1281 789 ...
 $ Dominant.Rock.Type : Factor w/ 12 levels "","Andesite / Basaltic Andesite",..: 5 3 11 3 6 12 5 12 7 12 ...
 $ Tectonic.Setting   : Factor w/ 12 levels "","Intraplate / Continental Crust (&gt;25 km)",..: 5 5 2 2 8 8 8 8 8 8 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen estadístico (mínimo, máximo, media, etc.) de la columna de elevación</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(volcanes<span class="sc">$</span>Elevation..Meters.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-4200.0   687.2  1464.0  1683.4  2352.2  6879.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar la cantidad de volcanes por tipo (columna 'Type'), ordenando de mayor a menor frecuencia</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>volcanes <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Type, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Type   n
1        Stratovolcano 597
2               Shield 129
3    Stratovolcano(es) 121
4            Submarine 116
5  Pyroclastic cone(s)  99
6       Volcanic field  88
7              Caldera  86
8              Complex  54
9         Lava dome(s)  38
10           Shield(s)  35
11    Pyroclastic cone  18
12     Fissure vent(s)  16
13            Compound  14
14             Maar(s)  13
15           Lava dome  12
16          Caldera(s)  11
17        Tuff cone(s)   9
18                Maar   8
19  Pyroclastic shield   8
20         Crater rows   6
21          Subglacial   6
22      Stratovolcano?   4
23           Lava cone   3
24           Tuff cone   3
25             Unknown   3
26 Explosion crater(s)   2
27        Fissure vent   2
28       Submarine(es)   2
29         Complex(es)   1
30             Cone(s)   1
31        Lava cone(s)   1
32        Tuff ring(s)   1
33   Volcanic field(s)   1</code></pre>
</div>
</div>
</section>
</section>
<section id="visualización-de-los-datos" class="level1">
<h1>Visualización de los datos</h1>
<p>Vamos a visualizar algunos de los datos para entender su comportamiento, primero analicemos la elevación y veamos como se distribuyen por región.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma de elevación de volcanes </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(volcanes, <span class="fu">aes</span>(<span class="at">x =</span> Elevation..Meters.)) <span class="sc">+</span>   </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()<span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Elevación de volcanes del Holoceno"</span>, <span class="at">x =</span> <span class="st">"Elevación (m)"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_mapas_SDAR_y_PBDB_files/figure-html/Histograma-volcanes-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Histograma de la elevación de los volcanes</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analicemos el comportamiento de la elevación </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(volcanes<span class="sc">$</span>Elevation..Meters.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   vars    n    mean     sd median trimmed     mad   min  max range skew
X1    1 1508 1683.36 1571.1   1464 1553.34 1220.92 -4200 6879 11079 0.64
   kurtosis    se
X1     1.36 40.46</code></pre>
</div>
</div>
<p>Veamos la altura de los volcanes por región.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un histograma de elevaciones, coloreando las barras por región</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(volcanes, <span class="fu">aes</span>(<span class="at">x =</span> Elevation..Meters., <span class="at">fill =</span> Region)) <span class="sc">+</span>   </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span>  <span class="co"># Barras con borde blanco</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Elevación de volcanes del Holoceno"</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Elevación (m)"</span>, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frecuencia"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Región"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),  <span class="co"># Centrar el título</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>                <span class="co"># Ubicar la leyenda a la derecha</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_mapas_SDAR_y_PBDB_files/figure-html/bar-plot-volcanes-region-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Histograma de la elevación de los volcanes por región</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Describir los datos por región imprime un resultado demasiado largo y no</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># explica mucho viendolo así</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#describeBy(x=volcanes$Elevation..Meters. , group = volcanes$Region)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="manipulación-y-limpieza-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="manipulación-y-limpieza-de-los-datos">Manipulación y limpieza de los datos</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Haz una gráfica de barras de la cantidad de volcanes por región usando <code>geom_col().</code></p></li>
<li><p>Encuentra cuáles son los volcanes con la mayor y menor elevación de todos.</p></li>
<li><p>Calcula el promedio de elevación por región y crea una gráfica de barras con ese dato.</p></li>
</ul>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Gráfico de barras: cantidad de volcanes por región</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Esto se puede hacer de dos formas, usando pipes y creando el </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#gráfico directamente o haciendo un dataframe con los valores filtrados</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creando la variable conteo</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>conteo <span class="ot">&lt;-</span> volcanes <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Region, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#conteo</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando pipes y graficando directamente</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>volcanes <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contamos por región</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Region, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span>  <span class="co"># Contar volcanes por región</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos el diagrama de barras</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(Region, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"cyan2"</span>, <span class="at">color=</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Poner regiones en el eje Y para mejor lectura</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Número de volcanes por región"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Región"</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cantidad de volcanes"</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_mapas_SDAR_y_PBDB_files/figure-html/cantidad-volcanes-región-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Gráfica de barras de la cantidad de volcanes por región</figcaption>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Encontrar los volcanes con mayor y menor elevación</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando el operador pipe es mucho más facil hacer este tipo de busquedas</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>volcan_mas_alto <span class="ot">&lt;-</span> volcanes <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Elevation..Meters. <span class="sc">==</span> <span class="fu">max</span>(Elevation..Meters., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>volcan_mas_bajo <span class="ot">&lt;-</span> volcanes <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Elevation..Meters. <span class="sc">==</span> <span class="fu">min</span>(Elevation..Meters., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar resultados</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>volcan_mas_alto</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Number                     Name         Country        Region          Type
1 355130 Ojos del Salado, Nevados Chile-Argentina South America Stratovolcano
  Activity.Evidence Last.Known.Eruption Latitude Longitude Elevation..Meters.
1    Eruption Dated              750 CE  -27.109   -68.541               6879
  Dominant.Rock.Type                             Tectonic.Setting
1             Dacite Subduction Zone / Continental Crust (&gt;25 km)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>volcan_mas_bajo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Number               Name           Country         Region      Type
1 381040 Pico Fracture Zone Undersea Features Atlantic Ocean Submarine
  Activity.Evidence Last.Known.Eruption Latitude Longitude Elevation..Meters.
1 Eruption Observed             1865 CE    38.75    -38.08              -4200
  Dominant.Rock.Type                     Tectonic.Setting
1            No Data Intraplate / Oceanic Crust (&lt; 15 km)</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Promedio de elevación por región + gráfico de barras</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#igualmente tenmos las mismas dos opciones para esto</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>elev_promedio  <span class="ot">&lt;-</span> volcanes <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio_elev =</span> <span class="fu">mean</span>(Elevation..Meters., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>elev_promedio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 2
   Region                         promedio_elev
   &lt;fct&gt;                                  &lt;dbl&gt;
 1 Africa and Red Sea                     1621 
 2 Alaska                                 1491.
 3 Antarctica                             1583.
 4 Atlantic Ocean                          851.
 5 Canada and Western USA                 2229.
 6 Hawaii and Pacific Ocean              -1062.
 7 Iceland and Arctic Ocean                934.
 8 Indonesia                              1759.
 9 Japan, Taiwan, Marianas                 894.
10 Kamchatka and Mainland Asia            1704.
11 Kuril Islands                          1035.
12 Mediterranean and Western Asia         1714 
13 Melanesia and Australia                 875.
14 México and Central America             1933.
15 Middle East and Indian Ocean           1664.
16 New Zealand to Fiji                     152.
17 Philippines and SE Asia                1304.
18 South America                          3816.
19 West Indies                             960.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>volcanes <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio_elev =</span> <span class="fu">mean</span>(Elevation..Meters., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(Region, promedio_elev), <span class="at">y =</span> promedio_elev)) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">color=</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Elevación promedio de volcanes por región"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Región"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Elevación promedio (m)"</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_mapas_SDAR_y_PBDB_files/figure-html/elev_promedio-volcanes-región-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Gráfica de barras de la elevación promedio por región</figcaption>
</figure>
</div>
</div>
</div>
<p>Manipulemos los datos de edad para pasar de factores a valores númericos, así poder usarlos como datos “continuos” y calcular sus caracteristicas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una nueva columna numérica para la última erupción</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>volcanes <span class="ot">&lt;-</span> volcanes <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reemplazar "BCE" por valores negativos y "CE" por positivos</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Eruption_Year =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># str_detect es como select pero para texto</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(Last.Known.Eruption, <span class="st">"BCE"</span>) <span class="sc">~</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.integer</span>(<span class="fu">str_remove</span>(Last.Known.Eruption, <span class="st">" BCE"</span>)),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(Last.Known.Eruption, <span class="st">"CE"</span>) <span class="sc">~</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.integer</span>(<span class="fu">str_remove</span>(Last.Known.Eruption, <span class="st">" CE"</span>)),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      Last.Known.Eruption <span class="sc">==</span> <span class="st">"Unknown"</span> <span class="sc">~</span> <span class="cn">NA_integer_</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_integer_</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `Eruption_Year = case_when(...)`.
Caused by warning:
! NAs introducidos por coerción
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar resultados</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#volcanes %&gt;% </span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(Last.Known.Eruption, Eruption_Year) %&gt;% </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  distinct()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creación-de-mapas" class="level2">
<h2 class="anchored" data-anchor-id="creación-de-mapas">Creación de mapas</h2>
<p>Ahora podemos graficar los datos en un mapa, en <code>R</code> hay muchas dormas y paquetes que permiten hacer mapas, nosotros usaremos el paquete <code>maps</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener coordenadas del mapa mundial</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"world"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el mapa con ggplot</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Dibujar el mapa base del mundo</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_map</span>(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> world_map, <span class="at">map =</span> world_map,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(long, lat, <span class="at">map_id =</span> region),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"gray50"</span>, <span class="at">size =</span> <span class="fl">0.05</span>, <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Agregar los volcanes como puntos (solo los que tienen año conocido)</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> volcanes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Eruption_Year)),  <span class="co"># Eliminar filas con NA</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">color =</span> Eruption_Year),</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">linewidth =</span> <span class="dv">2</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Escala de colores perceptualmente uniforme</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Etiquetas y título</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución global de volcanes activos en el Holoceno"</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitud"</span>,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Latitud"</span>,</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Última erupción (año)"</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),  <span class="co"># Centrar el título</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_mapas_SDAR_y_PBDB_files/figure-html/mapa-mundial-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Mapa del mundo de volcanes</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Crea un mapa en donde solo se vea Sudamérica (longitud: -90, -30; latitud:-60, 15) y guardalo como pdf o svg.</p>
<p><code>Puedes hacerlo solo limitando la vista del mapa o también filtrando los valores</code></p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar volcanes en Sudamérica (rango aproximado)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>volcanes_sud <span class="ot">&lt;-</span> volcanes <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Latitude <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">60</span>, Latitude <span class="sc">&lt;=</span> <span class="dv">15</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         Longitude <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">90</span>, Longitude <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">30</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Eruption_Year))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa centrado en Sudamérica con solo volcanes de la región</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>mapa_volcanes_sud<span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> world_map,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> volcanes_sud,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude, <span class="at">color =</span> Eruption_Year),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Solo con añadir este comando al mapa anterior sería suficiente</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pero filtrar los datos hace que sea mucho más eficiente</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="sc">-</span><span class="dv">30</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Volcanes en Sudamérica"</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Longitud"</span>, <span class="at">y =</span> <span class="st">"Latitud"</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Última erupción (año)"</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave("mapa_volcanes_Sudamerica.pdf", mapa_volcanes_sud)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ahora hagamos un mapa interactivo usando las librerias <code>sf</code> y <code>mapview</code></p>
</section>
</section>
<section id="modelos-estadísticos-y-aprendizaje-estadístico" class="level1">
<h1>Modelos estadísticos y aprendizaje estadístico</h1>
<section id="introducción-a-los-modelos-estadísticos-y-el-aprendizaje-estadístico" class="level2">
<h2 class="anchored" data-anchor-id="introducción-a-los-modelos-estadísticos-y-el-aprendizaje-estadístico">Introducción a los Modelos Estadísticos y el Aprendizaje Estadístico</h2>
<p>Antes de sumergirnos en modelos específicos como el lineal, es crucial entender el marco general de los <strong>modelos estadísticos</strong> y el <strong>aprendizaje estadístico</strong>. En esencia, ambos buscan lo mismo: comprender y predecir patrones en los datos.</p>
<p>Un <strong>modelo estadístico</strong> es una representación matemática simplificada de la realidad. Nos ayuda a entender cómo una o más <strong>variables predictoras</strong> (también llamadas independientes) influyen en una <strong>variable de respuesta</strong> (o dependiente). Estos modelos se basan en supuestos sobre la distribución de los datos y las relaciones entre las variables, permitiéndonos inferir propiedades de una población a partir de una muestra. Por ejemplo, podríamos querer modelar cómo la temperatura global influye en el tamaño corporal promedio de una especie fósil a lo largo del tiempo geológico.</p>
<p>El <strong>aprendizaje estadístico</strong> es un campo más amplio que utiliza una variedad de técnicas, algunas de las cuales son modelos estadísticos, para “aprender” de los datos. Su objetivo principal es hacer predicciones precisas o descubrir patrones ocultos. En paleontología, esto podría implicar entrenar un algoritmo para clasificar automáticamente fósiles según su morfología o para predecir la edad de una muestra o estrato basándose en la composición de su microfauna.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Recursos para profundizar
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para aprender en profundidad sobre como producir <strong>modelos estadísticos</strong> con R <a href="https://www.tmwr.org/">Tidy Modeling with R</a></p>
<p>Para aprender sobre <strong>aprendizaje estadístico</strong> con ejemplos en R y Python <a href="https://www.statlearning.com/">An Introduction to Statistical Learning</a></p>
</div>
</div>
<section id="métodos-del-aprendizaje-estadístico-un-espectro-de-flexibilidad" class="level3">
<h3 class="anchored" data-anchor-id="métodos-del-aprendizaje-estadístico-un-espectro-de-flexibilidad">Métodos del Aprendizaje Estadístico: Un Espectro de Flexibilidad</h3>
<p>Existen dos tipos principales de problemas en el aprendizaje estadístico:</p>
<ol type="1">
<li><strong>Aprendizaje Supervisado</strong>: Se utiliza cuando tenemos una <strong>variable de respuesta</strong> conocida y queremos predecirla basándonos en variables predictoras. Los métodos aprenden una relación mapeando las variables de entrada a la variable de salida.</li>
</ol>
<pre><code>-   **Regresión**: La variable de respuesta es cuantitativa (numérica continua). Ejemplos incluyen el **Modelo Lineal (LM)**, la regresión polinómica, las máquinas de soporte vectorial para regresión, y los árboles de regresión.

-   **Clasificación**: La variable de respuesta es cualitativa (categórica). Ejemplos son la regresión logística, los clasificadores de Bayes, las máquinas de soporte vectorial para clasificación, y los árboles de decisión.</code></pre>
<ol start="2" type="1">
<li><strong>Aprendizaje No Supervisado</strong>: Se emplea cuando no tenemos una variable de respuesta específica. El objetivo es encontrar patrones o estructuras ocultas dentro de los datos por sí mismos.</li>
</ol>
<pre><code>-   **Clustering (Agrupamiento)**: Como vimos, agrupa observaciones similares en conglomerados. Esencial para la taxonomía numérica o la identificación de paleocomunidades.

-   **Reducción de Dimensionalidad**: Técnicas como el **Análisis de Componentes Principales (PCA)** y el **Análisis de Correspondencias (CA/MCA)**, que buscan simplificar la complejidad de los datos al reducir el número de variables manteniendo la mayor cantidad de información posible.</code></pre>
</section>
<section id="flexibilidad-vs-interpretabilidad" class="level3">
<h3 class="anchored" data-anchor-id="flexibilidad-vs-interpretabilidad">Flexibilidad vs Interpretabilidad</h3>
<p><img src="images/clipboard-3535280407.png" class="img-fluid"></p>
<p>(Tomado de: An Introduction to Statistical Learning with Applications in R Second Edition, James, <em>et al.)</em></p>
<p>Una consideración fundamental en el aprendizaje estadístico es la relación inversa entre la <strong>flexibilidad</strong> de un método y su <strong>interpretabilidad</strong>:</p>
<ul>
<li><p><strong>Flexibilidad</strong>: Se refiere a la capacidad de un método para ajustarse a una amplia gama de formas de datos, incluso relaciones no lineales complejas. Los métodos más flexibles pueden capturar patrones más intrincados en los datos, lo que a menudo lleva a una mayor precisión predictiva.</p></li>
<li><p><strong>Interpretabilidad</strong>: Se refiere a la facilidad con la que podemos entender cómo funciona un modelo y cómo las variables predictoras influyen en la variable de respuesta. Es decir, qué tan fácil es extraer <em>insights</em> y explicaciones claras del modelo.</p></li>
</ul>
<p>Generalmente, a medida que un método se vuelve más <strong>flexible</strong>, su <strong>interpretabilidad disminuye</strong>.</p>
<ul>
<li><p><strong>Modelos Menos Flexibles (Mayor Interpretabilidad)</strong>: El <strong>Modelo Lineal (LM)</strong> es un excelente ejemplo. Es relativamente simple y sus coeficientes tienen una interpretación directa (cambio en <span class="math inline">\(Y\)</span> por cada unidad de cambio en <span class="math inline">\(X\)</span>). Esto lo hace muy útil cuando el objetivo es comprender la naturaleza de la relación. Sin embargo, no puede capturar relaciones no lineales complejas.</p></li>
<li><p><strong>Modelos Más Flexibles (Menor Interpretabilidad)</strong>: Métodos como las <strong>redes neuronales</strong> o los <strong>bosques aleatorios</strong> son mucho más flexibles y pueden modelar relaciones altamente no lineales y complejas en los datos, lo que a menudo resulta en una mayor precisión predictiva. Sin embargo, es mucho más difícil entender <em>por qué</em> hacen una predicción particular o <em>cómo</em> las variables individuales contribuyen a la salida, lo que a veces los denomina “cajas negras”.</p></li>
<li><p>La elección del método dependerá de nuestro objetivo: ¿necesitamos la máxima precisión predictiva (flexibilidad), o es más importante entender la relación subyacente y la influencia de variables específicas (interpretabilidad)? A menudo, un enfoque combinado, usando modelos interpretables para la exploración inicial y modelos más flexibles para predicciones de alta precisión, es la estrategia más efectiva.</p></li>
</ul>
</section>
</section>
<section id="modelo-lineal-lm-comprendiendo-relaciones" class="level2">
<h2 class="anchored" data-anchor-id="modelo-lineal-lm-comprendiendo-relaciones">Modelo Lineal (LM): Comprendiendo Relaciones</h2>
<p>El <strong>Modelo Lineal</strong> (LM por sus siglas en inglés, <em>Linear Model</em>), a menudo conocido como <strong>Regresión Lineal Simple</strong> cuando hay una sola variable predictora, es una de las técnicas estadísticas más utilizadas y fundamentales. Permite modelar la relación lineal entre una variable de respuesta (o dependiente) y una o más variables predictoras (o independientes). Su objetivo principal es predecir el valor de la variable dependiente basándose en los valores de las variables independientes.</p>
<section id="qué-es-un-modelo-lineal" class="level3">
<h3 class="anchored" data-anchor-id="qué-es-un-modelo-lineal">¿Qué es un Modelo Lineal?</h3>
<p>La forma más básica de un modelo lineal es la de una línea recta, que se puede expresar matemáticamente como:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X + \epsilon\]</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\(Y\)</span> es la <strong>variable de respuesta</strong> (o dependiente), el valor que queremos predecir o explicar.</p></li>
<li><p><span class="math inline">\(X\)</span> es la <strong>variable predictora</strong> (o independiente), el valor que usamos para predecir <span class="math inline">\(Y\)</span>. En modelos lineales múltiples, puede haber múltiples variables <span class="math inline">\(X\)</span>.</p></li>
<li><p><span class="math inline">\(\beta_0\)</span> es el <strong>intercepto</strong> (o coeficiente de intercepción), que representa el valor esperado de <span class="math inline">\(Y\)</span> cuando <span class="math inline">\(X\)</span> es igual a 0.</p></li>
<li><p><span class="math inline">\(\beta_1\)</span> es el <strong>coeficiente de la pendiente</strong> (o coeficiente de regresión), que indica cuánto cambia el valor esperado de <span class="math inline">\(Y\)</span> por cada unidad de aumento en <span class="math inline">\(X\)</span>.</p></li>
<li><p><span class="math inline">\(\epsilon\)</span> (épsilon) es el <strong>término de error</strong> o residual, que representa la variabilidad en <span class="math inline">\(Y\)</span> que no puede ser explicada por <span class="math inline">\(X\)</span>. Se asume que estos errores son aleatorios, independientes, normalmente distribuidos y con varianza constante (homocedasticidad).</p></li>
</ul>
<p>Cuando tenemos múltiples variables predictoras, el modelo se extiende a:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k + \epsilon\]</span></p>
<p>Donde <span class="math inline">\(X_1 +  X_2 + \dots + X_k\)</span> son las diferentes variables predictoras y <span class="math inline">\(\beta_1 + \beta_2 + \dots + \beta_k\)</span> son sus respectivos coeficientes.</p>
</section>
<section id="cómo-se-leen-los-resultados-de-un-modelo-lineal" class="level3">
<h3 class="anchored" data-anchor-id="cómo-se-leen-los-resultados-de-un-modelo-lineal">¿Cómo se leen los resultados de un Modelo Lineal?</h3>
<p>Al ejecutar un modelo lineal en un software estadístico (como R o Python), los resultados típicos que obtendrás son:</p>
<ol type="1">
<li><strong>Estimaciones de los Coeficientes</strong> (<span class="math inline">\(\beta_0, \beta_1 , \dots , \beta_k\)</span>):</li>
</ol>
<ul>
<li><p><strong>Intercepto</strong> (<span class="math inline">\(\beta_0\)</span>): Nos dice el valor promedio de la variable de respuesta cuando todas las variables predictoras son 0. Su interpretación puede ser directa o no, dependiendo si el 0 es un valor significativo para las variables predictoras.</p></li>
<li><p><strong>Coeficientes de las Predictoras</strong> <span class="math inline">\(\beta_1 , \dots , \beta_k\)</span>): Cada coeficiente <span class="math inline">\(\beta_i\)</span> indica el cambio promedio en la variable de respuesta Y por cada unidad de aumento en la variable predictora <span class="math inline">\(X_i\)</span>, manteniendo constantes las otras variables predictoras en el modelo.</p></li>
</ul>
<ol start="2" type="1">
<li><p><strong>Error Estándar de los Coeficientes</strong>: Mide la precisión de la estimación de cada coeficiente. Un error estándar pequeño indica una estimación más precisa.</p></li>
<li><p><strong>Valor</strong> <span class="math inline">\(t\)</span> (o Estadística t): Es el cociente entre el coeficiente estimado y su error estándar. Se utiliza para probar la hipótesis nula de que el coeficiente es igual a cero (es decir, que la variable predictora no tiene un efecto lineal significativo sobre la variable de respuesta).</p></li>
<li><p><strong>Valor</strong> <span class="math inline">\(p\)</span> (o <span class="math inline">\(Pr(&gt;|t|)\)</span>): Es la probabilidad de observar un valor t tan extremo (o más extremo) como el calculado, asumiendo que la hipótesis nula es verdadera.</p></li>
</ol>
<ul>
<li><p>Si el <strong>valor</strong> <span class="math inline">\(p\)</span> es pequeño (típicamente menor que un nivel de significancia <span class="math inline">\(\alpha\)</span>, por ejemplo, 0.05), se rechaza la hipótesis nula. Esto sugiere que el coeficiente es estadísticamente significativo, y la variable predictora tiene un efecto lineal sobre la variable de respuesta.</p></li>
<li><p>Si el <strong>valor</strong> <span class="math inline">\(p\)</span> es grande, no se rechaza la hipótesis nula, indicando que no hay evidencia suficiente para decir que la variable predictora tiene un efecto lineal significativo.</p></li>
</ul>
<ol start="5" type="1">
<li><span class="math inline">\(R^2\)</span> (Coeficiente de Determinación):</li>
</ol>
<ul>
<li><p>El <span class="math inline">\(R^2\)</span> es un valor entre 0 y 1 que indica la proporción de la varianza total de la variable de respuesta que es explicada por el modelo lineal.</p></li>
<li><p>Un <span class="math inline">\(R^2\)</span> de 0.70 significa que el 70% de la variabilidad en <span class="math inline">\(Y\)</span> puede ser explicada por las variables predictoras del modelo.</p></li>
<li><p>Un <span class="math inline">\(R^2\)</span> más alto generalmente indica un mejor ajuste del modelo a los datos, aunque no necesariamente implica que el modelo sea “bueno” para la predicción o que capture la verdadera relación causal.</p></li>
<li><p><span class="math inline">\(R^2\)</span> Ajustado: Similar al <span class="math inline">\(R^2\)</span>, pero penaliza la inclusión de variables predictoras que no contribuyen significativamente a la explicación de la varianza.</p></li>
</ul>
<ol start="6" type="1">
<li><strong>Estadística</strong> <span class="math inline">\(F\)</span> y su Valor <span class="math inline">\(p\)</span>:</li>
</ol>
<ul>
<li><p>La estadística <span class="math inline">\(F\)</span> y su valor <span class="math inline">\(p\)</span> asociado evalúan la significancia global del modelo. Prueban la hipótesis nula de que todos los coeficientes de las variables predictoras (excepto el intercepto) son simultáneamente cero.</p></li>
<li><p>Un <strong>valor</strong> <span class="math inline">\(p\)</span> pequeño para la estadística <span class="math inline">\(F\)</span> (usualmente menor que 0.05) sugiere que el modelo en su conjunto es estadísticamente significativo, es decir, que al menos una de las variables predictoras tiene un efecto significativo sobre Y.</p></li>
</ul>
<p>En resumen, los modelos lineales son una herramienta poderosa y relativamente fácil de interpretar para explorar y cuantificar relaciones lineales entre variables, lo que los convierte en un pilar del análisis de datos.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>